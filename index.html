<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinners MC - Sistema</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ´â€â˜ ï¸</text></svg>">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Modal de Login -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <img src="sinners-banner.png" alt="Sinners MC" class="login-banner">
            <p class="login-subtitle">Sistema Interno - Digite seu ID</p>
            <input type="text" id="idInput" placeholder="Digite seu ID..." inputmode="numeric" pattern="[0-9]*" class="login-input">
            <div id="statusMsg" class="login-status"></div>
            <button onclick="verificarID()" class="login-btn">ğŸ”“ ACESSAR</button>
            <small class="login-hint">Pressione Enter para enviar</small>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel hidden">
        <h3>ğŸ‘‘ Painel Admin</h3>
        <div class="admin-section">
            <input type="text" id="newIdInput" placeholder="Novo ID..." inputmode="numeric" pattern="[0-9]*" class="admin-input">
            <button onclick="aprovarID()" class="admin-btn approve">âœ… Aprovar ID</button>
        </div>
        <div class="admin-section">
            <button onclick="mostrarLogs()" class="admin-btn logs">ğŸ“‹ Ver Logs</button>
        </div>
        <div class="admin-section">
            <button onclick="mostrarIDsAprovados()" class="admin-btn users">ğŸ‘¥ IDs Aprovados</button>
        </div>
        <button onclick="fecharAdminPanel()" class="admin-btn close">âŒ Fechar</button>
    </div>
    
    <!-- Main Container -->
    <div id="mainContainer" class="container hidden">
        <div class="header">
            <img src="logo.png" alt="Sinners MC" style="height: 120px; margin: 15px 0;">
            <div class="header-buttons">
                <div class="user-info">
                    ID: <span id="currentUserId" class="user-id"></span>
                    <button onclick="logout()" class="logout-btn">ğŸšª Sair</button>
                    <button id="adminBtn" onclick="toggleAdminPanel()" class="admin-toggle-btn hidden">ğŸ‘‘ Admin</button>
                </div>
                <span id="sync-status" class="sync-status">ğŸ”„ Conectando...</span>
                <button id="manage-recipes-btn" class="manage-btn">âš™ï¸ Gerenciar Receitas</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="crafting">ğŸ”¨ Crafting</button>
            <button class="tab-btn" data-tab="npc-sales">ğŸ’° Venda NPC</button>
            <button class="tab-btn" data-tab="third-party">ğŸ›’ Compra de Terceiros</button>
            <button class="tab-btn" data-tab="lavagem">ğŸ’µ Lavagem</button>
            <button class="tab-btn" data-tab="mapa">ğŸ—ºï¸ Mapa</button>
        </div>
        
        <!-- Tab Content: Crafting -->
        <div id="crafting-tab" class="tab-content active">
            <div class="craft-section">
                <div class="input-group">
                    <label for="item-select">Item para Craftar:</label>
                    <select id="item-select">
                        <option value="">-- Selecione um item --</option>
                    </select>
                </div>
            
            <div class="input-group">
                <label for="quantity">Quantidade:</label>
                <input type="number" id="quantity" value="1" min="1">
            </div>
            
            <button id="calculate-btn">Calcular Recursos</button>
            <button id="add-to-list-btn" class="add-to-list-btn">â• Adicionar Ã  Lista</button>
            <button id="clear-btn">Limpar</button>
        </div>
        
        <div id="craft-list-section" class="craft-list-section hidden">
            <h2>ğŸ“‹ Lista de Crafting</h2>
            <div id="craft-list"></div>
            <div class="list-actions">
                <button id="calculate-total-btn" class="calculate-total-btn">ğŸ§® Calcular Total</button>
                <button id="clear-list-btn" class="clear-list-btn">ğŸ—‘ï¸ Limpar Lista</button>
            </div>
        </div>
        
        <div id="results" class="results hidden">
            <h2>ğŸ“Š Recursos NecessÃ¡rios</h2>
            <div id="resources-list"></div>
            
            <h3>ğŸ”„ Ãrvore de Crafting</h3>
            <div id="craft-tree"></div>
        </div>
        </div>

        <!-- Tab Content: NPC Sales -->
        <div id="npc-sales-tab" class="tab-content">
            <div class="npc-section">
                <div class="input-group">
                    <label for="npc-select">Selecione o NPC:</label>
                    <select id="npc-select">
                        <option value="">-- Selecione um NPC --</option>
                        <option value="galpao">ğŸšï¸ NPC GalpÃ£o</option>
                        <option value="garagem-sul">ğŸš— NPC Garagem Sul</option>
                    </select>
                </div>
                
                <div id="npc-items-section" class="npc-items-section hidden">
                    <h3 id="npc-title"></h3>
                    <div id="npc-items-list"></div>
                    
                    <div class="npc-total">
                        <h3>ğŸ’° Total da Venda</h3>
                        <div class="total-value">$<span id="npc-total-value">0</span></div>
                        <button id="clear-npc-btn" class="clear-btn">ğŸ—‘ï¸ Limpar SeleÃ§Ã£o</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Third Party Purchase -->
        <div id="third-party-tab" class="tab-content">
            <div class="third-party-section">
                <div class="tax-selection">
                    <label>Tipo de NegociaÃ§Ã£o:</label>
                    <div class="tax-buttons">
                        <button class="tax-btn active" data-tax="30">ğŸ‘¤ Normal (30%)</button>
                        <button class="tax-btn" data-tax="20">ğŸ¤ Aliados (20%)</button>
                    </div>
                </div>
                
                <div class="item-search-section">
                    <label for="item-search-input">Adicionar Item:</label>
                    <div class="search-input-wrapper">
                        <input type="text" id="item-search-input" placeholder="Digite o nome do item..." autocomplete="off">
                        <div id="item-suggestions" class="item-suggestions hidden"></div>
                    </div>
                </div>
                
                <div id="third-party-items-section" class="third-party-items-section">
                    <h3>Itens Selecionados</h3>
                    <div id="third-party-items-list" class="items-grid"></div>
                    
                    <div class="third-party-summary">
                        <div class="summary-row">
                            <span class="summary-label">Valor Base:</span>
                            <span class="summary-value">$<span id="third-party-base-value">0</span></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Taxa (<span id="third-party-tax-percent">20</span>%):</span>
                            <span class="summary-value tax-value">-$<span id="third-party-tax-value">0</span></span>
                        </div>
                        <div class="summary-row total-row">
                            <span class="summary-label">ğŸ’° Total a Pagar:</span>
                            <span class="summary-value total-value">$<span id="third-party-total-value">0</span></span>
                        </div>
                        <button id="clear-third-party-btn" class="clear-btn">ğŸ—‘ï¸ Limpar SeleÃ§Ã£o</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Lavagem -->
        <div id="lavagem-tab" class="tab-content">
            <div class="third-party-section">
                <h2>ğŸ’µ Sistema de Lavagem</h2>
                
                <div class="tax-buttons">
                    <button class="tax-btn" data-rate="30" onclick="setLavagemRate(30)">ğŸ‘¤ Normal (30%)</button>
                    <button class="tax-btn active" data-rate="20" onclick="setLavagemRate(20)">ğŸ¤ Aliados (20%)</button>
                </div>

                <div class="input-group">
                    <label for="lavagem-value">ğŸ’° Valor a Lavar (Dinheiro Sujo):</label>
                    <input type="number" id="lavagem-value" placeholder="Digite o valor..." min="0" step="100" oninput="calculateLavagem()">
                </div>

                <div class="third-party-total">
                    <h3>ğŸ“Š Resultado da Lavagem</h3>
                    <div class="total-row">
                        <span>ğŸ’° Dinheiro Sujo (Recebeu):</span>
                        <span id="lavagem-base-total" class="total-value">$0</span>
                    </div>
                    <div class="total-row tax-row">
                        <span>ğŸ’µ Sua Taxa de ServiÃ§o (<span id="lavagem-keep-label">20%</span>):</span>
                        <span id="lavagem-final-total" class="final-value">$0</span>
                    </div>
                    <div class="total-row final-row">
                        <span>âœ… Devolver Limpo (<span id="lavagem-loss-label">80%</span>):</span>
                        <span id="lavagem-tax-amount" class="tax-value">$0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Mapa -->
        <div id="mapa-tab" class="tab-content">
            <div class="mapa-section">
                <iframe src="mapa/index.html" class="mapa-iframe" frameborder="0"></iframe>
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Receitas -->
    <div id="recipe-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Gerenciar Receitas</h2>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="add-recipe-section">
                    <h3>â• Adicionar Nova Receita</h3>
                    
                    <div class="input-group">
                        <label for="new-item-name">Nome do Item:</label>
                        <input type="text" id="new-item-name" placeholder="Ex: Fuzil AK">
                    </div>
                    
                    <div class="input-group">
                        <label for="new-item-output">Quantidade que rende:</label>
                        <input type="number" id="new-item-output" value="1" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="new-item-image">URL da Imagem (opcional):</label>
                        <input type="text" id="new-item-image" placeholder="https://exemplo.com/imagem.png">
                        <div class="image-preview" id="image-preview"></div>
                    </div>
                    
                    <h4>Materiais NecessÃ¡rios:</h4>
                    <div id="materials-list">
                        <div class="material-row">
                            <input type="text" class="material-name" placeholder="Nome do material">
                            <input type="number" class="material-quantity" placeholder="Quantidade" min="1" value="1">
                            <button class="remove-material-btn" onclick="removeMaterial(this)">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <button id="add-material-btn" class="secondary-btn">+ Adicionar Material</button>
                    
                    <button id="save-recipe-btn" class="primary-btn">ğŸ’¾ Salvar Receita</button>
                    <button id="cancel-edit-btn" class="cancel-btn hidden">âŒ Cancelar EdiÃ§Ã£o</button>
                </div>
                
                <div class="recipes-list-section">
                    <h3>ğŸ“‹ Receitas Cadastradas</h3>
                    <div class="filter-group">
                        <input type="text" id="filter-recipes" placeholder="Filtrar receitas...">
                    </div>
                    <div id="existing-recipes"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Inicializar Firebase ANTES de tudo -->
    <script>
        const firebaseConfig = {
            databaseURL: "https://primordial-mile-249702-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    
    <script src="recipes.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
</body>
</html>
